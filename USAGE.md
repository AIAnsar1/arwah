# Arwah - Unified Network Scanner and Packet Sniffer

Arwah объединяет функциональность RustScan (сканирование портов) и Sniffglue (анализ сетевых пакетов) в единый инструмент.

## Режимы работы

### 1. Режим сканирования портов (Scan)
```bash
# Сканирование конкретного IP
arwah scan -a 192.168.1.1

# Сканирование диапазона портов
arwah scan -a 192.168.1.1 -p 1-1000

# Сканирование с использованием скриптов
arwah scan -a 192.168.1.1 -s default
```

### 2. Режим сниффинга пакетов (Sniff)
```bash
# Прослушивание сетевого интерфейса
arwah sniff

# Прослушивание конкретного интерфейса
arwah sniff -i eth0

# Чтение из файла pcap
arwah sniff -r capture.pcap

# JSON вывод
arwah sniff --json

# Отладочный режим
arwah sniff --debugging
```

### 3. Комбинированный режим (по умолчанию)
```bash
# Сначала сканирование, затем сниффинг
arwah --both

# Только сканирование (режим по умолчанию для обратной совместимости)
arwah
```

## Примеры использования

### Базовое сканирование сети
```bash
# Быстрое сканирование локальной сети
arwah scan -a 192.168.1.0/24

# Сканирование с высокой скоростью
arwah scan -a 192.168.1.1 -b 5000 -t 1000
```

### Анализ сетевого трафика
```bash
# Мониторинг HTTP трафика
arwah sniff -v 2

# Сохранение в JSON для дальнейшего анализа
arwah sniff --json > network_analysis.json

# Анализ файла захвата
arwah sniff -r suspicious_traffic.pcap --debugging
```

### Комплексный анализ безопасности
```bash
# Полный анализ: сканирование + мониторинг
arwah --both

# Сканирование с последующим мониторингом найденных сервисов
arwah scan -a target.com -s default && arwah sniff -i eth0
```

## Опции сканирования (Scan)

- `-a, --addresses <ADDRESSES>`: IP адреса или диапазоны для сканирования
- `-p, --ports <PORTS>`: Порты для сканирования
- `-b, --batch-size <BATCH_SIZE>`: Размер пакета для сканирования
- `-t, --timeout <TIMEOUT>`: Таймаут в миллисекундах
- `-s, --scripts <SCRIPTS>`: Скрипты для выполнения
- `--greppable`: Вывод в формате, удобном для grep
- `--accessible`: Доступный вывод для людей с ограниченными возможностями

## Опции сниффинга (Sniff)

- `-i, --interface <INTERFACE>`: Сетевой интерфейс для прослушивания
- `-r, --read <FILE>`: Чтение из файла pcap
- `-v, --verbose <LEVEL>`: Уровень детализации (0-4)
- `--json`: Вывод в формате JSON
- `--debugging`: Отладочный режим с подробной информацией
- `--threads <THREADS>`: Количество потоков для обработки
- `--promisc`: Включить promiscuous режим

## Интеграция и автоматизация

### Использование в скриптах
```bash
#!/bin/bash
# Автоматический анализ безопасности сети

echo "Сканирование сети..."
arwah scan -a $1 --greppable > scan_results.txt

echo "Мониторинг трафика в течение 60 секунд..."
timeout 60 arwah sniff --json > traffic_analysis.json

echo "Анализ завершен. Результаты в scan_results.txt и traffic_analysis.json"
```

### Docker использование
```bash
# Сканирование
docker run -it arwah scan -a 192.168.1.1

# Сниффинг (требует привилегированный режим)
docker run --privileged -it arwah sniff
```

## Безопасность и разрешения

- Для сниффинга пакетов требуются права администратора
- Используйте sandbox режим для повышения безопасности
- Опция `--insecure-disable-seccomp` отключает защиту (не рекомендуется)

## Производительность

### Оптимизация сканирования
- Увеличьте `--batch-size` для более быстрого сканирования
- Используйте `--ulimit` для увеличения лимита файловых дескрипторов
- Настройте `--timeout` в зависимости от задержки сети

### Оптимизация сниффинга
- Используйте `--threads` для многопоточной обработки
- Фильтруйте трафик с помощью уровня детализации `-v`
- Для анализа больших файлов используйте `--threads 1`

## Форматы вывода

### Сканирование
- Обычный: `192.168.1.1 -> [22,80,443]`
- Greppable: `192.168.1.1:22`, `192.168.1.1:80`, `192.168.1.1:443`

### Сниффинг
- Compact: Краткая информация о пакетах
- Debugging: Подробная техническая информация
- JSON: Структурированные данные для автоматической обработки

## Устранение неполадок

### Общие проблемы
1. **Нет разрешений**: Запустите с sudo для сниффинга
2. **Интерфейс не найден**: Проверьте доступные интерфейсы с `ip link`
3. **Высокая загрузка CPU**: Уменьшите batch-size или количество потоков
4. **Таймауты**: Увеличьте значение timeout для медленных сетей

### Отладка
```bash
# Включить подробное логирование
RUST_LOG=debug arwah sniff

# Проверить доступные интерфейсы
arwah sniff --help
```